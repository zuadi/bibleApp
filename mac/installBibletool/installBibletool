#!/bin/bash

# Resolve paths correctly
APP_DIR="$(cd "$(dirname "$0")/../.." && pwd)"
RESOURCES="$APP_DIR/Contents/Resources"
TARGET="/Applications"
SOURCE="$RESOURCES/Bibletool.app"

# Copy + remove quarantine (admin required)
osascript <<EOF
do shell script "cp -R '$SOURCE' '$TARGET' && xattr -dr com.apple.quarantine '$TARGET/Bibletool.app'" with administrator privileges
EOF

# Launch the app
open "$TARGET/Bibletool.app"

# Ask whether to eject the DMG
choice=$(osascript -e 'button returned of (display dialog "Installation is complete. Eject the installer disk now?" with title "Bibletool Installer" buttons {"No", "Yes"} default button "Yes" cancel button "No")')

# Only eject if Yes
if [ "$choice" = "Yes" ]; then
  VOLUME_NAME=$(basename "$APP_DIR")

  osascript <<EOF
tell application "Finder"
  delay 2
  if exists disk "$VOLUME_NAME" then
    eject disk "$VOLUME_NAME"
  end if
end tell
EOF
fi
